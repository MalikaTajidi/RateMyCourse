<!-- evaluation.component.html -->
<div class="evaluation-container">
  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Chargement des informations du module...</p>
  </div>

  <!-- En-t√™te avec le nom du module -->
  <div *ngIf="!isLoading && !errorMessage" class="evaluation-header">
    <h1>√âvaluation du module: {{ moduleName }}</h1>
    <div class="module-info">
      <p class="module-id">Module ID: {{ moduleId }}</p>
      <p *ngIf="moduleInfo" class="module-details">
        <span class="module-filiere">Fili√®re: {{ moduleInfo.filiere }}</span> | 
        <span class="module-credits">Cr√©dits: {{ moduleInfo.credits }}</span>
      </p>
      <p *ngIf="moduleInfo" class="module-description">{{ moduleInfo.description }}</p>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
    <button (click)="router.navigate(['/student-area/modules'])">Retour aux modules</button>
  </div>

  <!-- Message de succ√®s -->
  <div *ngIf="successMessage" class="success-message">
    <div class="success-icon">‚úì</div>
    <h2>√âvaluation compl√©t√©e</h2>
    <p>{{ successMessage }}</p>
    <p class="redirect-message">Vous allez √™tre redirig√© vers la page des modules...</p>
  </div>

  <!-- Contenu de l'√©valuation -->
  <div class="evaluation-content" *ngIf="!isLoading && !successMessage && !errorMessage">
    <!-- Barre de progression -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
      </div>
      <div class="progress-info">
        <span class="section-progress">Section {{ currentSection + 1 }}/{{ sections.length }}</span>
        <span class="question-progress">
          Questions r√©pondues: {{ getAnsweredQuestionsCount() }}/{{ getTotalQuestionsCount() }}
          ({{ getOverallProgress() | number:'1.0-0' }}%)
        </span>
      </div>
    </div>

    <!-- En-t√™te de section -->
    <div class="section-header" *ngIf="sections && sections.length > 0">
      <h2>{{ sections[currentSection].title }}</h2>
      <p>{{ sections[currentSection].description }}</p>
    </div>

    <!-- Formulaire d'√©valuation -->
    <form [formGroup]="evaluationForm" (ngSubmit)="onSubmit()" *ngIf="sections && sections.length > 0">
      <!-- Questions de la section actuelle -->
      <div class="questions-container">
        <div *ngFor="let question of sections[currentSection].questions" class="question-item">
          <div class="question-content">
            <h3>{{ question.content }} <span class="required-star">*</span></h3>
            
            <!-- Options de r√©ponse (√©chelle de 1 √† 5) -->
            <div class="rating-options">
              <div *ngFor="let option of question.options; let i = index" class="rating-option">
                <label [for]="'q' + question.id + '_' + i" 
                       [class.selected]="evaluationForm.get('question_' + question.id)?.value === option">
                  <input
                    type="radio"
                    [id]="'q' + question.id + '_' + i"
                    [value]="option"
                    [formControlName]="'question_' + question.id"
                  >
                  <span class="option-text">{{ option }}</span>
                </label>
              </div>
            </div>
            
            <!-- Message d'erreur si la question n'est pas r√©pondue -->
            <div *ngIf="showValidationErrors && !isQuestionAnswered(question.id)" class="validation-error">
              Veuillez r√©pondre √† cette question.
            </div>
          </div>
        </div>
      </div>

      <!-- Validation de la section -->
      <div class="section-validation" *ngIf="showValidationErrors">
        <p [class.validation-success]="isSectionValid(currentSection)" 
           [class.validation-error]="!isSectionValid(currentSection)">
          {{ getSectionValidationMessage() }}
        </p>
      </div>

      <!-- Champ de commentaires (derni√®re section seulement) -->
      <div *ngIf="currentSection === sections.length - 1" class="comments-section">
        <h3>Commentaires additionnels (optionnel)</h3>
        <p>Partagez vos commentaires, suggestions ou remarques concernant ce module :</p>
        <textarea
          formControlName="comments"
          class="comments-textarea"
          placeholder="Vos commentaires sur le module, suggestions d'am√©lioration, points positifs, etc."
          rows="4">
        </textarea>
      </div>

      <!-- Boutons de navigation -->
      <div class="navigation-buttons">
        <button
          type="button"
          class="btn-previous"
          *ngIf="currentSection > 0"
          (click)="previousSection()"
          [disabled]="isSubmitting"
        >
          <span class="btn-icon">‚Üê</span>
          <span class="btn-text">Section pr√©c√©dente</span>
        </button>

        <button
          type="button"
          class="btn-next"
          *ngIf="currentSection < sections.length - 1"
          (click)="nextSection()"
          [disabled]="isSubmitting"
        >
          <span class="btn-text">Section suivante</span>
          <span class="btn-icon">‚Üí</span>
        </button>

        <button
          type="submit"
          class="btn-submit"
          *ngIf="currentSection === sections.length - 1 && !evaluationSubmitted"
          [disabled]="isSubmitting || !evaluationForm.valid"
        >
          <span *ngIf="!isSubmitting">
            <span class="btn-icon">‚úì</span>
            <span class="btn-text">Soumettre l'√©valuation</span>
          </span>
          <span *ngIf="isSubmitting && !isGeneratingPDF" class="loading-spinner">
            Traitement en cours...
          </span>
          <span *ngIf="isGeneratingPDF" class="loading-spinner">
            <span class="btn-icon">üìÑ</span>
            G√©n√©ration du PDF...
          </span>
        </button>

        <!-- Bouton pour t√©l√©charger √† nouveau le PDF -->
        <button
          type="button"
          class="btn-download-pdf"
          *ngIf="evaluationSubmitted"
          (click)="downloadPDFAgain()"
          [disabled]="isGeneratingPDF"
        >
          <span *ngIf="!isGeneratingPDF">
            <span class="btn-icon">üì•</span>
            <span class="btn-text">T√©l√©charger le PDF</span>
          </span>
          <span *ngIf="isGeneratingPDF" class="loading-spinner">
            <span class="btn-icon">üìÑ</span>
            G√©n√©ration du PDF...
          </span>
        </button>
      </div>
    </form>

    <!-- Messages d'erreur et de succ√®s -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="success-message">
      {{ successMessage }}
    </div>

    <!-- Message de confirmation apr√®s soumission -->
    <div *ngIf="evaluationSubmitted" class="submission-confirmation">
      <div class="confirmation-icon">‚úÖ</div>
      <h3>√âvaluation soumise avec succ√®s !</h3>
      <p>Votre √©valuation a √©t√© enregistr√©e et un PDF a √©t√© g√©n√©r√© automatiquement.</p>
      <div class="confirmation-actions">
        <button
          class="btn-download-pdf-large"
          (click)="downloadPDFAgain()"
          [disabled]="isGeneratingPDF">
          <span *ngIf="!isGeneratingPDF">
            <span class="btn-icon">üì•</span>
            T√©l√©charger le PDF √† nouveau
          </span>
          <span *ngIf="isGeneratingPDF">
            <span class="btn-icon">üìÑ</span>
            G√©n√©ration en cours...
          </span>
        </button>
        <button
          class="btn-back-to-modules"
          (click)="router.navigate(['/student-area/modules'])">
          <span class="btn-icon">üìö</span>
          Retour aux modules
        </button>
      </div>
    </div>
  </div>
</div>


