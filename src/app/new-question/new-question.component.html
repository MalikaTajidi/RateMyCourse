<div class="form-container">
  <div class="title-section">
    <h2>{{ editMode ? 'Modifier un Formulaire' : 'Ajouter un Formulaire' }}</h2>
  </div>

  <form [formGroup]="formulaireFormGroup">
    <div class="mb-4">
      <label class="form-label required-field">Nom du formulaire</label>
      <input type="text" class="form-control" formControlName="name" placeholder="Nom du formulaire">
    </div>

    <div class="mb-4">
      <label class="form-label required-field">Type</label>
      <input type="text" class="form-control" formControlName="type" placeholder="Type du formulaire">
    </div>

    <!-- Sections avec Questions intégrées -->
    <div class="mb-4">
      <label class="form-label">Sections</label>
      <div formArrayName="sections">
        <div class="module-card" *ngFor="let section of sections.controls; let i = index" [formGroupName]="i">
          <div class="row">
            <div class="col-md-10">
              <label class="form-label">Description</label>
              <input type="text" class="form-control" formControlName="description" placeholder="Description de la section">
            </div>
            <div class="col-md-2 module-actions">
              <button type="button" class="btn btn-outline-danger" (click)="supprimerSection(i)">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>

          <!-- Questions dans chaque section -->
          <div formArrayName="questions" class="mt-3">
            <label class="form-label">Questions</label>
            <div class="module-card" *ngFor="let question of getQuestions(i).controls; let j = index" [formGroupName]="j">
              <div class="row">
                <div class="col-md-10">
                  <input type="text" class="form-control" formControlName="content" placeholder="Contenu de la question">
                </div>
                <div class="col-md-2 module-actions">
                  <button type="button" class="btn btn-outline-danger" (click)="supprimerQuestion(i, j)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="add-module-btn" (click)="ajouterQuestion(i)">
              <i class="fas fa-plus-circle me-2"></i> Ajouter une question
            </div>
          </div>
        </div>
      </div>

      <div class="add-module-btn" (click)="ajouterSection()">
        <i class="fas fa-plus-circle me-2"></i> Ajouter une section
      </div>
    </div>

    <div class="form-buttons">
      <button  type="button" class="btn btn-outline-secondary btn-action" routerLink="/question">
        <i class="fas fa-arrow-left me-2"></i> Retour
      </button>
      <button (click)="editMode ?  onUpdateForm() : onSaveForm()" type="button" class="btn btn-primary btn-action"  [disabled]="formulaireFormGroup.invalid">
        <i  class="fas fa-save me-2"></i> Enregistrer
      </button>
    </div>
  </form>
</div>
